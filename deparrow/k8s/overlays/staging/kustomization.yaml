# Staging Environment Overlay
# Pre-production environment for testing

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: deparrow-staging

nameSuffix: -staging

resources:
  - ../../base
  # External Secrets Operator - uncomment when SecretStore is configured
  # - patches/external-secrets.yaml

patchesStrategicMerge:
  - patches/metaos-staging.yaml
  - patches/gui-staging.yaml
  - patches/postgres-staging.yaml
  - patches/redis-staging.yaml
  - patches/orchestrator-staging.yaml
  - patches/compute-staging.yaml
  - patches/hpa-staging.yaml
  - patches/ingress-staging.yaml

# Staging-specific config
configMapGenerator:
  - name: deparrow-config
    behavior: merge
    literals:
      - LOG_LEVEL=info
      - NODE_ENV=staging
      - DEPARROW_CREDIT_RATE=0.5

# Staging secrets - use external secret management
# secretGenerator:
#   - name: deparrow-secrets
#     behavior: merge
#     # Reference external secrets

# Staging image tags
images:
  - name: deparrow/metaos
    newTag: staging
  - name: deparrow/gui
    newTag: staging
  - name: ghcr.io/bacalhau-project/bacalhau
    newTag: v1.6.0

# Staging replicas
replicas:
  - name: metaos
    count: 2
  - name: gui
    count: 2
  - name: compute-node-dind
    count: 3
