# PostgreSQL production resources
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
spec:
  replicas: 1
  template:
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: postgres
              topologyKey: kubernetes.io/hostname
      containers:
        - name: postgres
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              cpu: 2000m
              memory: 2Gi
          env:
            - name: POSTGRES_MAX_CONNECTIONS
              value: "500"
            - name: POSTGRES_SHARED_BUFFERS
              value: "512MB"
            - name: POSTGRES_WORK_MEM
              value: "64MB"
            - name: POSTGRES_EFFECTIVE_CACHE_SIZE
              value: "1GB"
  volumeClaimTemplates:
    - metadata:
        name: postgres-data
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 100Gi
        storageClassName: fast-ssd
